# -*- Mode: Python -*- vi:si:et:sw=4:sts=4:ts=4:syntax=python

from cerbero.tools.libtool import LibtoolLibrary

class Recipe(recipe.Recipe):
    name = 'harfbuzz'
    btype = BuildType.MESON
    version = '2.8.1'
    stype = SourceType.GIT
    remotes = {'origin': 'https://github.com/pascomnet/harfbuzz.git'}
    commit = 'origin/2.8.1_pascom'
    licenses = [{License.BSD_like: ['COPYING']}]
    deps = ['fontconfig', 'cairo', 'glib']
    meson_options = {'icu': 'disabled',
                     'glib': 'enabled',
                     'cairo': 'enabled', # Is this needed? Is it only used for cmd line utils?
                     'gobject': 'disabled',
                     'icu_builtin': 'false',
                     'introspection': 'disabled',
                     'tests': 'disabled'}

    files_bins = ['hb-ot-shape-closure', 'hb-view', 'hb-shape']
    files_libs = ['libharfbuzz']
    files_devel = ['include/harfbuzz/*.h', 'lib/pkgconfig/harfbuzz.pc']

    def post_install(self):
        # Meson does not generate la files
        LibtoolLibrary('harfbuzz', None, None, None,
                self.config.libdir, self.config.target_platform,
                deps=['glib-2.0', 'freetype', 'fontconfig']).save()
        LibtoolLibrary('harfbuzz-subset', None, None, None,
                self.config.libdir, self.config.target_platform,
                deps=['harfbuzz']).save()
        super().post_install()
